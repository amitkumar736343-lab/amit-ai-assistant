<script>

let chats=[{id:Date.now(),messages:[]}]
let active=chats[0].id

const chatArea=document.getElementById("chatArea")

function activeChat(){
return chats.find(c=>c.id===active)
}

function addMessage(role,text){

activeChat().messages.push({role,text})

renderMessages()

}

function renderMessages(){

chatArea.innerHTML=""

activeChat().messages.forEach(m=>{

let div=document.createElement("div")

div.className=m.role==="user"?"text-right":""

let bubble=document.createElement("div")

bubble.className="inline-block bg-white shadow rounded p-3 max-w-xl"

bubble.innerHTML=marked.parse(m.text)

div.appendChild(bubble)

chatArea.appendChild(div)

})

chatArea.scrollTop=999999

}


// â­ ChatGPT typing animation

async function typingReply(text){

let msg=""

let div=document.createElement("div")

let bubble=document.createElement("div")

bubble.className="inline-block bg-white shadow rounded p-3 max-w-xl"

div.appendChild(bubble)

chatArea.appendChild(div)

for(let c of text){

msg+=c

bubble.innerHTML=marked.parse(msg+" â–‹")

await new Promise(r=>setTimeout(r,20))

chatArea.scrollTop=999999

}

bubble.innerHTML=marked.parse(msg)

}


// â­ Voice Speak

function speakAI(text){

let speech=new SpeechSynthesisUtterance(text)

speech.lang="en-US"

speechSynthesis.speak(speech)

}


// â­ REAL AI CHAT

async function sendChat(){

let input=document.getElementById("prompt")

let text=input.value.trim()

if(!text)return

input.value=""

addMessage("user",text)

addMessage("assistant","ğŸ¤– Thinking...")

try{

let res=await fetch(

"https://patient-mountain-73cc.amitkumar736343.workers.dev/chat"

)

let data=await res.json()

await typingReply(data.reply)

speakAI(data.reply)

}catch(e){

addMessage("assistant","âŒ API Error")

}

}


// â­ Voice Mic (double tap Send)

let lastTap=0

send.onclick=()=>{

let now=Date.now()

if(now-lastTap<400){

startVoice()

}else{

sendChat()

}

lastTap=now

}


function startVoice(){

let rec=new webkitSpeechRecognition()

rec.lang="en-US"

rec.start()

rec.onresult=e=>{

document.getElementById("prompt").value=

e.results[0][0].transcript

sendChat()

}

}


// â­ IMAGE GENERATOR

async function makeImage(prompt,ratio){

addMessage("assistant","ğŸ–¼ Generating image...")

let size="1024x1024"

if(ratio==="16:9") size="1280x720"

if(ratio==="9:16") size="720x1280"

if(ratio==="3:4") size="768x1024"

let w=size.split("x")[0]

let h=size.split("x")[1]

let url=

`https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=${w}&height=${h}`

setTimeout(()=>{

addMessage("assistant",

`![img](${url})

<button onclick="makeVideoFromImage('${url}')">

ğŸ¬ Make Video

</button>`)

},1200)

}


// â­ VIDEO PREVIEW

function makeVideoFromImage(img){

addMessage("assistant","ğŸ¬ Creating cinematic video...")

let video=

`<video controls autoplay loop style="max-width:100%">

<source src="${img}" type="video/mp4">

</video>`

setTimeout(()=>{

addMessage("assistant",

"ğŸ¬ Cinematic Preview:<br>"+video)

},1200)

}


function makeVideo(prompt,ratio){

addMessage("assistant",

"ğŸ¬ Hollywood 8s Video Prompt:\n"+prompt+

"\nRatio:"+ratio)

}


// â­ Aspect

let actionType=null

function openAspect(type){

actionType=type

aspectModal.style.display="flex"

}

aspectModal.onclick=e=>{

if(e.target.classList.contains("option")){

let ratio=e.target.dataset.r

aspectModal.style.display="none"

let prompt=window.prompt(

actionType==="image"?"Image Prompt?":"Video Prompt?"

)

if(!prompt)return

if(actionType==="image")

makeImage(prompt,ratio)

if(actionType==="video")

makeVideo(prompt,ratio)

}

}


// EVENTS

imageBtn.onclick=()=>openAspect("image")

videoBtn.onclick=()=>openAspect("video")

menuBtn.onclick=

()=>sidebar.classList.toggle("hide")

newChat.onclick=()=>{

let id=Date.now()

chats.unshift({id,messages:[]})

active=id

renderMessages()

}

plusBtn.onclick=()=>{

alert("+ Upload coming ğŸ”¥")

}

renderMessages()

</script>
